\documentclass[letterpaper,final,12pt,reqno]{amsart}

\usepackage[total={6.3in,9.2in},top=1.1in,left=1.1in]{geometry}

\usepackage{times,bm,bbm,empheq,fancyvrb,graphicx}
\usepackage[dvipsnames]{xcolor}
\usepackage{longtable}
\usepackage{booktabs}

\usepackage[within=section]{newfloat}

\usepackage{tikz}
\usetikzlibrary{decorations.pathreplacing}

\usepackage[kw]{pseudo}
\pseudoset{left-margin=15mm,topsep=5mm,idfont=\texttt}

% hyperref should be the last package we load
\usepackage[pdftex,
colorlinks=true,
plainpages=false, % only if colorlinks=true
linkcolor=blue,   % ...
citecolor=Red,    % ...
urlcolor=black    % ...
]{hyperref}

\renewcommand{\baselinestretch}{1.05}

\allowdisplaybreaks[1]  % allow display breaks in align environments, if they avoid major underfulls

\newtheoremstyle{claim}% name
  {5pt}% space above
  {5pt}% space below
  {\itshape}% body font
  {}% indent amount
  {\itshape}% theorem head font
  {.}% punctuation after theorem head
  {.5em}% space after theorem head
  {\thmname{#1}\thmnumber{ #2}\thmnote{ (#3)}}% theorem head spec
\theoremstyle{claim}
\newtheorem{theorem}{Theorem}
\newtheorem{lemma}{Lemma}

\newcommand{\eps}{\epsilon}
\newcommand{\RR}{\mathbb{R}}

\newcommand{\grad}{\nabla}
\newcommand{\Div}{\nabla\cdot}
\newcommand{\trace}{\operatorname{tr}}

\newcommand{\hbn}{\hat{\mathbf{n}}}

\newcommand{\bb}{\mathbf{b}}
\newcommand{\be}{\mathbf{e}}
\newcommand{\bbf}{\mathbf{f}}
\newcommand{\bg}{\mathbf{g}}
\newcommand{\bn}{\mathbf{n}}
\newcommand{\br}{\mathbf{r}}
\newcommand{\bu}{\mathbf{u}}
\newcommand{\bv}{\mathbf{v}}
\newcommand{\bw}{\mathbf{w}}
\newcommand{\bx}{\mathbf{x}}

\newcommand{\bF}{\mathbf{F}}
\newcommand{\bV}{\mathbf{V}}
\newcommand{\bX}{\mathbf{X}}

\newcommand{\bxi}{\bm{\xi}}

\newcommand{\bzero}{\bm{0}}

\newcommand{\rhoi}{\rho_{\text{i}}}

\newcommand{\ip}[2]{\left<#1,#2\right>}

\newcommand{\mR}{R^{\bm{\oplus}}}
\newcommand{\iR}{R^{\bullet}}

\newcommand{\pp}{{\text{p}}}
\newcommand{\qq}{{\text{q}}}
\newcommand{\rr}{{\text{r}}}

% numbering
\setcounter{tocdepth}{3}
\makeatletter
\def\l@subsection{\@tocline{2}{0pt}{4pc}{5pc}{}}
\makeatother

\numberwithin{equation}{section}
\numberwithin{figure}{section}
\numberwithin{table}{section}
\numberwithin{theorem}{section}

\DeclareFloatingEnvironment[name=Pseudocode]{pcode}

\begin{document}
\title[Multilevel computation of glacier geometry from Stokes dynamics]{Multilevel computation of glacier geometry \\ from Stokes dynamics}

\author{Ed Bueler}

\author{Lawrence Mitchell}

\begin{abstract} FIXME MCD for steady and evolving geometry with Glen-Stokes dynamics
\end{abstract}

\maketitle

%\tableofcontents

\thispagestyle{empty}
%\bigskip

\section{Introduction} \label{sec:intro}

FIXME MCD = multilevel constraint decomposition, a multigrid \cite{Trottenbergetal2001} method basically by \cite{Tai2003} for obstacle problems; see \cite{Bueler2022};  obstacle problem view first extended to Stokes by \cite{WirbelJarosch2020}


\section{The steady ice geometry problem} \label{sec:stokesgeometry}

The standard model for determining the geometry of glaciers is based in part upon a dynamical description of ice flow, namely a shear-thinning version of the Stokes equations.  This Glen-Stokes ice-dynamics model can only determine the free-surface glacier geometry when it is combined with the surface kinematical equation (SKE) and a form of climate input, namely the rate of accumulation of snow or ablation, i.e.~melting and runoff.  In this section we state the strong form of this ``coupled'' glacier geometry model in the steady-state case, which we call the steady ice geometry problem (SIGP).  The emphasis here is on the complementarity-problem nature of the SIGP, often not explicit in the glaciers literature (e.g.~as observed by \cite{SchoofHewitt2013}).  We then define its weak form, noting along the way several unknown aspects of the theory.  Section \ref{sec:evolution} gives the straightfoward extension of the steady case to a time-discretized evolving-geometry model, the implicit ice geometry problem (IIGP).

The SIGP is defined on a fixed, bounded map-plane region $\Omega \subset \RR^d$ (Figure \ref{fig:stokesdomain}).  We denote the map-plane variables as $x$ when $d=1$ and $x,y$ when $d=2$.  On $\Omega$ we assume that a climatic mass balance (CMB) function $a(x,y)$ is defined at every point, whether or not ice is present at that location.  In ice-free areas this function could be described as the ``potential'' CMB, namely the annual balance of snow accumulation and potential melt if ice were present \cite{Cogleyetal2011}, e.g.~as computed by energy balance in a climate or weather model.  Here we assume $a$ has units of ice thickness per time, equivalently ice volume per area (in $\Omega$) per time, compatible with our assumption of constant ice density below.  Also we assume there is a bed elevation function $b(x,y)$ defined everywhere on $\Omega$, which determines the topography upon which the glacier sits.  The functions $a$ and $b$ are the data (inputs) of the SIGP.

\begin{figure}[t]
\begin{center}
\includegraphics[width=0.75\textwidth]{genfigs/stokesdomain.pdf}
\end{center}
\caption{In the steady ice geometry problem (SIGP) the CMB $a$ (arrows; downward $=$ accumulation) and bed elevation $b$ (solid) are given on a fixed map-plane region $\Omega \subset \RR^d$.  The solution includes a surface elevation $s$ (dashed) on $\Omega$; note $s=b$ where ice-free.  The ice velocity $\bu$ and pressure $p$ are defined in the icy domain: $\Lambda_s = \{(x,y,z)\,:\,b(x,y) < z < s(x,y)\} \subset \RR^{d+1}$.}
\label{fig:stokesdomain}
\end{figure}

The Glen-Stokes dynamical model, the so-called stress balance, for ice only applies in the icy domain in $\RR^{d+1}$.  We make a strong, but common \cite[for example]{IsaacStadlerGhattas2015,Jouvetetal2008,Lengetal2012,WirbelJarosch2020} assumption this this icy domain has a well-defined upper surface elevation, a function $s(x,y)$.  That is, we assume there are \emph{no overhangs}, and that the under-side of the ice is in contact with the bed $b$.  We then define $s$ everywhere in $\Omega$ by extending with $s=b$ where ice is absent, thus $s\ge b$ applies on $\Omega$.  Note that $s$ is part of the model solution; it is not given data.

However, as a consequence of the no-overhangs assumption, the SIGP as described here is likely not to be well-posed because of an issue at the ice margin.  There may be no steady state because the fluid in the vicinity of a steep ice margin, especially on a steep bed feature, ``wants'' to generate an overhang, violating the assumption that $s$ is well-defined.  Furthermore the same concern applies to each time step of an evolving model; the model does not stop overhangs from appearing at the margin.  However, because overhangs are small features in large glaciers and ice sheets, essentially all modeling literature ignores this possibility and assumes well-defined surface elevation and thickness \cite{Jouvetetal2008,Lengetal2012,WirbelJarosch2020}.  An exception is \cite{PralongFunk2005}, who furthermore suggest a potentially well-posed continuum model, a nontrivial extension of the one here, in which serac and ice-cliff calving occurs via a damage variable and a stress-fracture failure criterion.  This extended model also explains one of our numerical boundary variants, a short, fixed-height cliff (Section \ref{sec:mcdstokes}), but overhangs are not allowed in any of our numerical constructions.

Based on the assumption of a well-defined upper surface, we define the (solution) extent of the ice as the open set
\begin{equation}
\Lambda_s = \{(x,y,z)\,|\,(x,y) \in \Omega \,\text{ and }\, b(x,y) < z < s(x,y)\}  \subset \RR^{d+1}, \label{eq:lambdas}
\end{equation}
where $z$ is vertically-upward.  (If $d=1$ then coordinates are ``$(x,z)$'' on $\Lambda_s$.)  The map-plane region $\Omega$ need not be connected or simply-connected, but even if so the solution set $\Lambda_s$ need not be.  However, $\Lambda_s$ has the topology of the product of an open subset of $\Omega$ and an interval, and we will approximate it using an extruded mesh (Section \ref{sec:fe}).

For a given geometry $\Lambda_s$, we model the ice as a very-viscous \cite{Acheson1990}, non-Newtonian fluid subject to Glen's shear-thinning flow law \cite{GreveBlatter2009}; see also \cite[Chapter 1]{FowlerNg2021}.  Allowing any Glen exponent $n\ge 1$, the equations inside $\Lambda_s$ are
\begin{align}
- \nabla \cdot \tau + \nabla p &= \rhoi \bg &&\text{\emph{stress balance}} \label{eq:forcebalance} \\
\nabla \cdot \bu &= 0 &&\text{\emph{incompressibility}} \label{eq:incompressible} \\
\tau &= B_n |D\bu|^{(1/n) - 1} D\bu  &&\text{\emph{flow law}} \label{eq:viscflowlaw}
\end{align}
The solution fields here are the velocity $\bu$, pressure $p$, and deviatoric stress $\tau$.  Equations \eqref{eq:forcebalance} and \eqref{eq:viscflowlaw} form the momentum conservation (stress balance) model, while \eqref{eq:incompressible} is an aspect of our mass conservation model.  As seen below, mass conservation on the free surface of $\Lambda_s$ requires an additional equation \eqref{eq:ske}.

Regarding tensors and their notation, recall that the (Cauchy) stress tensor $\sigma$ decomposes into the deviatoric part $\tau$ minus the pressure, i.e.~$\sigma = \tau - p\,I$, so equation \eqref{eq:forcebalance} simply says $-\Div \sigma = \rhoi \bg$.  The strain rate tensor $D\bu$ is the symmetric part of $\grad \bu$, $D\bu = \frac{1}{2} \left(\grad\bu + \grad\bu^\top\right)$, and the tensor norm used in \eqref{eq:viscflowlaw} satisfies $|D\bu|^2 = \frac{1}{2} (D\bu)_{ij} (D\bu)_{ij}$.  Because $D\bu$ is symmetric, and because it has trace zero by equation \eqref{eq:incompressible}, i.e.~$\trace(D\bu)=\nabla \cdot \bu = 0$, equation \eqref{eq:viscflowlaw} implies that $\tau$ is also symmetric with trace zero, thus that $p=-(d+1)^{-1} \trace \sigma$.

In computations we will use constants $n=3$, ice density $\rhoi=910 \,\text{kg}\,\text{m}^{-3}$ \cite{Huybrechtsetal1996}, and gravity $\bg=\left<0,0,-g\right>$, with $g=9.81\,\text{m}\,\text{s}^{-2}$.  The ice hardness $B_n$ is a constant because we assume isothermal conditions \cite{GreveBlatter2009}, with $B_3=6.8082\times 10^7\,\text{Pa}\,\text{s}^{1/3}$ \cite{Huybrechtsetal1996}.

For the $n=1$ (Newtonian) Stokes equations one would write \eqref{eq:viscflowlaw} as $\tau = 2\nu D\bu$ with viscosity $\nu>0$, but exponents $n>1$ imply an effective viscosity function of $|D\bu|$.  This would thus be singular in the limit of small strain rates, and so, motivated by the actual finite viscosity of glacier ice \cite{GreveBlatter2009}, we define the regularized effective viscosity
\begin{equation}
\nu_\eps = \frac{1}{2} B_n \left(|D\bu|^2 + \eps\, D_0^2\right)^{(\pp-2)/2}, \label{eq:regeffvisc}
\end{equation}
where $\pp=(1/n)+1$, with $\pp=4/3$ in computations.  The constant $D_0$ defines a strain-rate scale for glacier flow; $D_0 = 1 \,\text{a}^{-1}$ and $\eps = 10^{-4}$ are used here.  Also we eliminate $\tau$ and rewrite \eqref{eq:forcebalance} as $- \nabla \cdot \left(2 \nu_\eps\, D\bu\right) + \nabla p = \rhoi \mathbf{g}$, with a vector $p$-Laplacian as the leading-order term.

Our SIGP model uses dynamic boundary conditions for isolated, grounded, and non-sliding ice.  In addition to the already-stated assumption that the top and bottom boundaries of $\Lambda_s$ can be identified, we further assume these surfaces have well-defined tangents.  On the upper free surface we set a condition of zero applied stress,
\begin{equation}
\left(2 \nu_\eps D\bu - pI\right) \bn_s = \bzero  \qquad \qquad \text{\emph{top} } \overline{\partial} \Lambda_s \label{eq:topbc}
\end{equation}
where $\bn_s$ is any normal to $\overline{\partial} \Lambda_s$.  (Providing a nonzero atmospheric pressure at the surface is straightforward, but it has no important consequence.)  On the base we impose no slip:
\begin{equation}
\bu = \bzero  \qquad\qquad \text{\emph{base} } \underline{\partial} \Lambda_s. \label{eq:basebc}
\end{equation}

Note that the ice flow extends in the horizontal direction until a free boundary at the glacier margin is reached, and the surface gradient $\grad s$ may become singular there, but the top and bottom surfaces are assumed to meet at the margin (Figure \ref{fig:stokesdomain}).  An alternative geometry with a small cliff is also considered (Section \ref{sec:fe}).  Real glacier margins may indeed occur as fracture-generated cliffs \cite{PralongFunk2005}, but fracture processes are not modeled here.

The well-posedness of the above dynamics model, for fixed domain $\Lambda_s$, is proven by \cite{JouvetRappaz2011}, and the solution is a unique pair $(\bu,p)$ defined on $\Lambda_s$.  (The function spaces are identified below when stating the weak formulation.)  However, the simultaneous determination of $\Lambda_s$ and $(\bu,p)$ is the goal of the SIGP model.  Indeed, the above equations make no reference to the climate input function $a$, so we need another ``equation'', which we will see is actually an inequality.

\newcommand{\bus}{\bu|_s}

Noting that the surface elevation is already defined on all of $\Omega$, with $s=b$ off the ice, we also extend the surface normal $\bn_s$, thus we set
\begin{equation}
\bn_s = \left<-s_x,-s_y,1\right> \label{eq:surfacenormal}
\end{equation}
so that the (un-normalized) surface normal is specified almost everywhere on $\Omega$.  (By contrast, note that the dynamical boundary condition \eqref{eq:topbc} applies only on top of the ice.)  Furthermore we extend the surface value of the velocity to all of $\Omega$:
\begin{equation}
\bus(x,y) = \begin{cases} \bu(x,y,s(x,y)), & s(x,y) > b(x,y), \\
                     \bzero, & \text{elsewhere}. \end{cases} \label{eq:surfacevelocity}
\end{equation}
(The movement of the solid earth would determine $\bu|_b \ne 0$, thus $\bu|_s$ could be nonzero in ice-free areas, and a more-complete model could include this small effect.)

The steady-state surface kinematical equation (SKE) \cite[see equation (5.21)]{GreveBlatter2009} is the needed additional aspect of mass conservation:
\begin{equation}
\bus \cdot \bn_s + a = 0 \qquad \text{\emph{on the ice}}. \label{eq:ske}
\end{equation}
Note that $a(x,y)$ is the \emph{vertical} ice thickness added per time.  (Some references use a distinct quantity, namely the thickness added perpendicularly to the ice surface \cite{GreveBlatter2009}, which is significantly different if the gradient $\grad s$ is large.)

While the involved quantities are defined everywhere, kinematical balance \eqref{eq:ske} applies only \emph{on} the ice.  However $\bus \cdot \bn_s + a \le 0$ everywhere in $\Omega$ because $a$ is nonpositive in steady state in ice-free locations.  In fact, when combined with the constraint that $s\ge b$ everywhere on $\Omega$, SKE \eqref{eq:ske} is part of an infinite-dimensional nonlinear complementarity problem (NCP) \cite{Bueler2021conservation}.  Recall that an NCP on a finite-dimensional vector space $V=\RR^k$ combines the three statements $x\ge 0$, $F(x)\ge 0$, and $x F(x)=0$, where $F:V\to V$ \cite{FacchineiPang2003}.

We may now state the strong form of the SIGP as follows:
\begin{align}
s - b &\ge 0 && \text{on $\Omega$} \label{eq:strongform} \\
- \bu|_s \cdot \bn_s - a &\ge 0 && \text{\emph{same}} \notag \\
(s - b) (- \bu|_s \cdot \bn_s - a) &= 0 && \text{\emph{same}} \notag \\
- \nabla \cdot \left(2 \nu_\eps\, D\bu\right) + \nabla p - \rhoi \mathbf{g} &= \bzero && \text{on $\Lambda_s$} \notag \\
\nabla \cdot \bu &= 0 && \text{\emph{same}} \notag \\
\left(2 \nu_\eps D\bu - pI\right) \bn_s &= \bzero && \text{on $\overline{\partial} \Lambda_s$} \notag \\
\bu &= \bzero && \text{on $\underline{\partial} \Lambda_s$} \notag
\end{align}
(Definition \eqref{eq:regeffvisc} is also needed.)  The first three statements in \eqref{eq:strongform} form the NCP, but it is coupled to the dynamical boundary value problem formed by the last four statements.

The solution of \eqref{eq:strongform} is a triple of functions $s(x,y)$, $\bu(x,y,z)$, $p(x,y,z)$.  However, as the domain on which $\bu,p$ are defined is only known via the solution elevation $s$, \eqref{eq:strongform} is at best an incomplete description.  The weak form in the next section, using a $s\mapsto \bu|_s$ solution operator, will partially address this concern.  Whether in strong or weak form, this inequality-constrained system of PDEs has a largely-unknown theory regarding well-posedness and solution regularity.  However, certain well-posedness theory is known for the SIA version of this problem, with existence established by \cite{JouvetBueler2012}, and uniqueness in the flat bed case.

In Sections \ref{sec:fe}--\ref{sec:mcdstokes} we will construct and demonstrate a robust multilevel scheme for the numerical solution of the SIGP weak form (Section \ref{sec:weakido}).  As noted in Section \ref{sec:intro}, numerical solutions have traditionally applied explicit time-stepping, even when computing steady states, splitting the dynamics and the SKE into sub-steps and using truncation to address the NCP \cite[for example]{Jouvetetal2008,Lengetal2012}.  By contrast, the implicit time-stepping model in Section \ref{sec:evolution} avoids time-splitting and is unconditionally stable.


\section{Weak form and the ice dynamics operator} \label{sec:weakido}

Recall that the weak form of a PDE states that a certain functional, constructed by multiplying by a test function and integrating by parts, is zero.  Both the solution and the test functions come from identified function spaces, namely Sobolev spaces \cite{Evans2010}.  Here we denote by $W^{\text{k},\text{r}}$ the Sobolev space of functions on which have $k$ derivatives which are $r$th-power integrable.

The weak form of the fixed-geometry Glen-Stokes model for ice, which extends the better-known linear Stokes weak form \cite{Elmanetal2014} to regularized power-law rheology, is relatively well-known \cite{IsaacStadlerGhattas2015,JouvetRappaz2011,Lengetal2012}, and we summarize it here.  Suppose that $\Lambda \subset \RR^{d+1}$ is fixed domain on which we prescribe a Dirchlet condition $\bu=0$ on a portion of the boundary, and where the remainder of the boundary (Neumann boundary) is stress-free.  Let $\pp=(1/n)+1$ as before, and let $\qq=(1-\pp^{-1})^{-1}=n+1$ be the conjugate exponent, so that $\pp^{-1}+\qq^{-1}=1$. (Note $\pp=4/3$ and $\qq = 4$ if $n=3$.)  Let $W_0^{1,\pp}(\Lambda)^{d+1}$ be the space of velocity functions which are zero along the Dirichlet boundary.  Let
\begin{equation}
\mathcal{M}_{\text{dyn}} = W_0^{1,\pp}(\Lambda)^{d+1} \times L^\qq(\Lambda)  \label{eq:mixed}
\end{equation}
be the (mixed) space of admissible velocity and pressure pairs, the dynamical variables.  The Glen-Stokes weak form is the statement that $(\bu,p) \in \mathcal{M}_{\text{dyn}}$ should satisfy
\begin{equation}
F_{\text{dyn}}(\bu,p)[\bv,q] = \int_\Lambda 2 \nu_\eps D\bu : D\bv - p \Div\bv - (\Div\bu) q - \rhoi \bg \cdot \bv\,d\bx = 0 \label{eq:glenstokesweak}
\end{equation}
for all $(\bv,q) \in \mathcal{M}_{\text{dyn}}$; as before the effective viscosity $\nu_\eps$ is defined by \eqref{eq:regeffvisc}.  Jouvet and Rappaz \cite{JouvetRappaz2011} have proven that this formulation is well-posed if $\Lambda$ is bounded, the Neumann boundary is $C^1$, and the Dirichlet boundary is nonempty.  In particular they show \eqref{eq:glenstokesweak} is equivalent to minimization of a coercive functional over the divergence-free subspace, and also that there is a unique pressure $p\in L^\qq(\Lambda)$.

Going beyond predetermined ice geometry, we are interested in finding a triple $s,\bu,p$ which solves the weak form of \eqref{eq:strongform}, where $s$ is the surface elevation.  Suppose $\Omega \subset \RR^d$ is the map-plane domain, and suppose the bed elevation $b$ is in $C^1(\overline{\Omega}) \subset W^{1,\qq}(\Omega)$.  Let
\begin{equation}
\mathcal{K} = \{s \in W^{1,\qq}(\Omega) \,:\, s \ge b \, \text{ and } \, s\big|_{\partial\Omega} = b\big|_{\partial\Omega}\}  \label{eq:Kconstraintset}
\end{equation}
be the set of admissible surface elevations of our isolated glacier or ice sheet.  This set is closed and convex.

As noted earlier it is not clear that the correct Sobolev space is identified in \eqref{eq:Kconstraintset}.  In fact we suppose when needed that
\begin{equation}
s\in \mathcal{K} \text{ defines an icy domain } \Lambda_s \text{ which has piecewise-$C^1$ boundary.} \label{eq:quixotic}
\end{equation}
This quixotic assumption connects the known theory of shallow ice sheet well-posedness \cite{JouvetBueler2012}, which motivates definition \eqref{eq:Kconstraintset}, to the widely-used numerical construction of evolving ice sheet geometries from Glen-Stokes dynamics \cite{Jouvetetal2008,Lengetal2012}.  Assumption \eqref{eq:quixotic} would follow from a sufficiently-strong regularity result for the theory presented in the current paper, which we cannot offer at this time, and subject to the no-overhangs hypothesis which might follow from the inclusion of non-fluid fracture processes (previous section).

If $\partial \Lambda$ is piecewise $C^1$ then the Sobolev space $W^{1,\pp}(\Lambda)$ supports a linear trace operator $T:W^{1,\pp}(\Lambda) \to L^\pp(\partial \Lambda)$ which defines $T(f) = f|_{\partial \Lambda}$ \cite[Section 5.5]{Evans2010}.

With the trace in mind we define the ice dynamics operator (IDO), a fundamental concept for our work (Figure \ref{fig:idoaction}).  For each surface elevation function $s \in \mathcal{K}$ the IDO result $\Phi(s)$ is the normal component of the upper-surface trace of the unique velocity solution $\bu$ of \eqref{eq:glenstokesweak} over the icy domain $\Lambda_s$, extended by zero to all of $\Omega$ (as in \eqref{eq:surfacevelocity}):
\begin{equation}
\Phi(s) = \begin{cases} \bu\big|_{\overline{\partial} \Lambda_s} \cdot \bn_s & s(x,y) > b(x,y), \\
                        \bzero & \text{otherwise}. \end{cases} \label{eq:ido}
\end{equation}
Note that the output $\Phi(s)$ may jump at the glacier margin; we only expect $\Phi(s) \in L^\pp(\Omega)$.

\begin{figure}[t]
\begin{center}
\includegraphics[width=\textwidth]{genfigs/idoaction.pdf}
\end{center}
\caption{The ice dynamics operator $\Phi$ maps the surface elevation $s$ (dashed) to the normal ice surface motion $\Phi(s)=\bu|_s \cdot \bn_s$; the thin line is $s+\Phi(s)$.  Both input and output are defined on all of $\Omega$.}
\label{fig:idoaction}
\end{figure}

Using the IDO, and recalling that the CMB $a$ is defined on all of $\Omega$, we may re-write the strong form \eqref{eq:strongform} as an NCP but with a hidden dynamical problem:
\begin{align}
s - b &\ge 0  \label{eq:idostrongform} \\
- \Phi(s) - a &\ge 0 \notag \\
(s - b) (- \Phi(s) - a) &= 0 \notag
\end{align}
Here the statements hold on all of $\Omega$, the data $a,b$ are clear, and the solution is the ice surface elevation $z=s(x,y)$.  The velocity and pressure $\bu,p$ are hidden variables within the evaluation of $\Phi(s)$.

It remains to write NCP \eqref{eq:idostrongform} in weak form.  For $s \in \mathcal{K}$ and $r \in W^{1,\qq}(\Omega)$ we define a functional which is nonlinear in $s$:
\begin{equation}
F(s)[r] = - \int_\Omega (\Phi(s) + a)\, r \,dx dy. \label{eq:sigpfunctional}
\end{equation}
One computes $F(s)[r]$ by defining the icy domain $\Lambda_s$ as in \eqref{eq:lambdas}, then solving the (weak form) Glen-Stokes problem \eqref{eq:glenstokesweak}, then evaluating the normal component of the surface trace of the velocity to compute the IDO \eqref{eq:ido}, and then integrating the SKE quantity $\Phi(s) + a$ against the test function $r$.  Implicit in formula \eqref{eq:sigpfunctional} is the assumption that $\Phi(s) + a$ is sufficiently regular to be in the dual space of $W^{1,\qq}(\Omega)$, but this allows significant singularities.

The SIGP weak form is a variational inequality (VI) \cite{KinderlehrerStampacchia1980} which should determine $s\in\mathcal{K}$:
\begin{equation}
F(s)[r - s] \ge 0 \quad \text{for all $r \in \mathcal{K}$.}  \label{eq:sigpweakform}
\end{equation}
This VI has a shallow (SIA) analog, for which existence has been proven \cite{JouvetBueler2012}, but in that case the functional is an integral of powers of the thickness $s-b$ and the surface slope $\grad s$, thus locally-computable.  Here the computation of $F$ in \eqref{eq:sigpfunctional} is non-local and expensive; to evaluate $F(s)[r]$ one must solve the Glen-Stokes problem on the given $z=s(x,y)$ geometry.

To the best of our knowledge VI \eqref{eq:sigpweakform} does \emph{not} arise as a constrained minimization.  The general-bed, steady SIA model is also not a minimization, except in the flat-bed case \cite{JouvetBueler2012}.  Despite this situation, to understand \eqref{eq:sigpweakform} one may analogize to minimization over the closed and convex set $\mathcal{K}$, regarding $F(s)$ as a gradient-like vector.  Definition \eqref{eq:sigpfunctional} can be interpreted as a dual pairing of $F(s)$ and $r$, thus roughly an inner product, in which case the VI says that $s$ is located in $\mathcal{K}$, generically on $\partial\mathcal{K}$, at a place where $F(s)$ points directly into $\mathcal{K}$.  In geometrical analogy, \eqref{eq:sigpweakform} says that the ``angle'' between $F(s)$ and an arbitrary vector $r-s$ pointing into $\mathcal{K}$ is at most $90^\circ$.

Thus the SIGP couples the weak forms \eqref{eq:glenstokesweak} and \eqref{eq:sigpweakform}.  It therefore has three fundamental nonlinearities, namely the Glen power-law rheology, the inequality constraint, and the nonlinearity of free-surface flow reflected in the nonlinearity of the operator $\Phi$.  Observe that even the classical obstacle problem for the linear Laplacian operator is nonlinear \cite{KinderlehrerStampacchia1980}, and also that a free-surface flow for Newtonian (linear) rheology produces a nonlinear equation for the flow thickness, e.g.~as expressed in the kinematic wave equation \cite{Ockendonetal2003}.

In order to numerically solve \eqref{eq:sigpweakform} we will use the (Gateaux) derivative of the functional $F$ in \eqref{eq:sigpfunctional}, which requires differentiating the IDO $\Phi$ in \eqref{eq:ido} as well.  The efficient computation of these derivatives will also involve an important approximation.

To compute the derivative of $F$ from \eqref{eq:surfacenormal} and \eqref{eq:sigpfunctional}, suppose $s\in \mathcal{K}$, $\eps>0$, and $t \in W^{1,\qq}(\Omega)$ is such that $s+\eps t \in \mathcal{K}$.  (In other words, both $s$ and $s+\eps t$ must be admissible glacier surface elevations.)  Then
\begin{equation}
F'(s,t)[r] = \lim_{\eps\to 0^+} \frac{F(s+\eps t)[r] - F(s)[r]}{\eps} = - \int_\Omega \Phi'(s,t)\, r \,dx dy \label{eq:sigpfunctionalderiv}
\end{equation}
where a product-rule computation gives
\begin{align}
\Phi'(s,t) &= \lim_{\eps\to 0^+} \frac{\bu|_{s+\eps t} \cdot \bn_{s+\eps t} - \bus \cdot \bn_s}{\eps} \label{eq:idoderiv} \\
    &= - \left(\lim_{\eps\to 0^+} \frac{\bu|_{s+\eps t} - \bus}{\eps}\right) \cdot \bn_s + \Phi(s) \cdot \left<t_x,t_y,0\right>. \notag
\end{align}
In this computation note that the normal vectors and surface velocities are extended to the whole of $\Omega$; see \eqref{eq:surfacevelocity}.  Observe that $F'$ is straightforward to compute from $\Phi'$.  We will assume that $\Phi'(s,t)$ is in the dual space of $W^{1,\qq}(\Omega)$, thus that \eqref{eq:sigpfunctionalderiv} is finite, but again this allows substantial irregularity.

The new functionals $F'(s,t)$ and $\Phi'(s,t)$ are one-sided directional derivatives in the sense that $s+\eps t$ must be admissible, i.e.~$s+\eps t\ge b$, for all sufficiently-small $\eps>0$.  This requires $t\ge 0$ only on the (active) set where $s=b$.  However, to simplify our considerations we define an $s$-independent set
\begin{equation}
\mathcal{D}_+ = \{t \in W^{1,\qq}(\Omega) \,:\, t(x,y) \ge 0\}. \label{eq:infdefectset}
\end{equation}
Then $\Phi'$ is well-defined on inputs $(s,t) \in \mathcal{K} \times \mathcal{D}_+$ and $F'$ is well-defined for $(s,t,r) \in \mathcal{K} \times \mathcal{D}_+ \times W^{1,\qq}(\Omega)$.

In the next two sections we construct an iterative, multilevel finite element solver for the SIGP.  However, a significant issue arises from formula \eqref{eq:idoderiv}, namely that to compute the difference $\bu|_{s+\eps t} - \bus$, two Glen-Stokes solutions are seemingly required, namely over the ice domains $\Lambda_{s+\eps t}$ and $\Lambda_s$.  The next section includes an approximation scheme which avoids such large numbers of Glen-Stokes solves.


\section{Finite element discretization} \label{sec:fe}

Suppose $\mathcal{T}$ is a triangulation of $\Omega$, which we assume is polygonal.  Based on its low expected regularity at the ice margin, assume that surface elevations $s\in \mathcal{K}$ are represented using the piecewise-linear ($P_1$) finite element (FE) space \cite{Elmanetal2014}
\begin{equation}
\mathcal{V}^h = \{s:\Omega \to \RR \,:\, s|_T \text{ is linear for each } T \in \mathcal{T}, \text{ and $s$ is continuous}\}. \label{eq:feP1}
\end{equation}
(Note \cite{JouvetBueler2012} make the same choice for the SIA problem.)  Let $b^h \in \mathcal{V}^h$ be the discretized bed elevation, e.g.~the $P_1$ interpolant of $b$, and let
\begin{equation}
\mathcal{K}^h = \{r \in \mathcal{V}^h \,:\, r \ge b^h \text{ and } r|_{\partial\Omega} = b^h|_{\partial\Omega}\}, \qquad \mathcal{D}_+^h = \{t \in \mathcal{V}^h \,:\, t \ge 0\}. \label{eq:feKD}
\end{equation}

With these FE choices, the discrete SIGP is to compute $s^h \in \mathcal{K}^h$ such that
\begin{equation}
F^h(s^h)[r - s^h] \ge 0 \quad \text{for all } r \in \mathcal{K}^h  \label{eq:fesigpweakform}
\end{equation}
where $F^h(s)[r] = - \int_\Omega (\Phi^h(s) + a)\, r \,dx dy$, essentially as before, but with $\Phi^h$ an FE approximation of the IDO $\Phi$.  (We will compute $\Phi^h$ using a extruded-mesh approximation of the Glen-Stokes problem \eqref{eq:glenstokesweak}, about which we will say more below.)  We suppose that the discrete SIGP is well-posed, subject to the caveats in the last section regarding overhangs at the margin.

Let $p$ denote an arbitrary node of the mesh $\mathcal{T}$, $(x_p,y_p)$ the coordinates of that node, and $\psi_p \in \mathcal{V}^h$ the corresponding $P_1$ hat function such that $\psi_p(x_q,y_q)=\delta_{pq}$ \cite{Elmanetal2014}.  Note that, because $\psi_p \in \mathcal{D}_+^h$, if $r \in \mathcal{K}^h$ then $r + c \psi_p \in \mathcal{K}^h$ for all $c\ge b(x_p,y_p) - r(x_p,y_p)$.

FIXME use Firedrake \cite{Alnaesetal2014,Rathgeberetal2016} with extruded meshes \cite{Gibsonetal2019,McRaeetal2016} for computing $\Phi^h$


\section{Smoothers} \label{sec:smoothers}

As a first step toward solving \eqref{eq:fesigpweakform} we now propose (slow) solvers which will become smoothers in our multilevel method (next section)  The smoothers are the projected nonlinear Gauss-Seidel and projected nonlinear Jacobi (PNJ) methods \cite{KinderlehrerStampacchia1980}.  Given a current surface elevation $s\in \mathcal{K}^h$, these methods sweep through the nodes in a fixed order, solving one-dimensional VI problems, as follows, and updating $s$.  For node $p$ let $\omega_p^s = b(x_p,y_p) - s(x_p,y_p)$.  The one-dimensional VI at $p$ implied by \eqref{eq:fesigpweakform} is to find $c \ge \omega_p^s$ such that
\begin{equation}
F^h(s+c\psi_p)[(s+\gamma \psi_p) - (s+c \psi_p)] \ge 0 \label{eq:fepointwiseviEARLY}
\end{equation}
for all $\gamma \ge \omega_p^s$.  Defining $F_p^h(c) = F^h(s+c\psi_p)[\psi_p]$, \eqref{eq:fepointwiseviEARLY} is equivalent to the simplified form
\begin{equation}
(\gamma - c) F_p^h(c) \ge 0. \label{eq:fepointwisevi}
\end{equation}
Supposing \eqref{eq:fepointwisevi} is well-posed and solved for $c$, the surface elevation $s$ is then updated $s \gets s + c \psi_p$ by the smoother.  (Observe that admissibility is preserved: the updated surface elevation is also in $\mathcal{K}^h$.)  Each pointwise update is done immediately by the (serial) PNGS smoother, while the (parallel) PNJ smoother computes solutions to \eqref{eq:fepointwisevi} at all nodes $p$ before the updates.

If $F_p^h(c)$ were linear and increasing then the solution of \eqref{eq:fepointwisevi} would be given by a simple formula \cite{GraeserKornhuber2009}, namely $c = \max\left\{-\beta/\alpha, \omega_p^s\right\}$ if $F_p^h(c) = \alpha c + \beta$ with $\alpha > 0$, but in fact $F_p^h(c)$ is nonlinear.  The simplest approximation scheme is thus to linearize $F_p^h(c)$, that is, smooth using one projected Newton step for the one-dimensional VI problem at each node.  To implement this strategy, note that \eqref{eq:sigpfunctionalderiv} and \eqref{eq:idoderiv} imply
\begin{equation}
F_p^h(c) = F^h(s+c\psi_p)[\psi_p] \approx F^h(s)[\psi_p] + c\, (F^h)'(s,\psi_p)[\psi_p] = \alpha c + \beta \label{eq:fepointwisefunctionalapprox}
\end{equation}
where
\begin{align}
\alpha &= \int_\Omega \left(- \left(\lim_{\eps\to 0^+} \frac{\bu^h|_{s+\eps \psi_p} - \bu^h|_s}{\eps}\right) \cdot \bn_s + \Phi^h(s) \cdot \left<(\psi_p)_x,(\psi_p)_y,0\right>\right)\, \psi_p \,dx dy \label{eq:fepointwisealpha} \\
\beta &= - \int_\Omega (\Phi^h(s) + a)\, \psi_p \,dx dy \label{eq:fepointwisebeta}
\end{align}
Each smoother application will require at least one solution of the Glen-Stokes problem \eqref{eq:glenstokesweak} on the geometry determined by the current surface elevation.  In fact, supposing we have computed $\bu^h|_s$ and $\Phi^h(s)$ then several terms in these formulas are straightforward FE computations over the support of $\psi_p$.

However, if we wish to compute $\alpha$ in \eqref{eq:fepointwisealpha}, even approximately, then it remains to compute a difference quotient in \eqref{eq:fepointwisealpha}, which in turn requires evaluating a perturbed-geometry surface velocity $\bu^h|_{s+\eps \psi_p}$.  The expensive direct way of doing this is to solve a Glen-Stokes problem for the perturbed upper-surface geometry $z=s + \eps \psi_p$.

Thus we seek a less expensive way to estimate the perturbed velocity field for a small ``bump'' $\eps\psi_p$ added to the surface elevation $s$.  For small $\eps$ the nonlinearities of the Glen-Stokes problem should be modest, but furthermore the most important change to the velocity and pressure fields from this bump would be through the perturbed gravitational load of the ice in the bump.  Thus FIXME

FIXME Pseudocode \ref{pc:pnj} for PNJ with bump approximation

\begin{pcode}[ht]
\begin{pseudo*}
\pr{pnj}(j,g^j,y^j,N^j,\ell^j,\phi^j,\id{newtonits}=2,\id{omega}=0.67)\text{:} \\+
    \ct{check admissibility: $y^j \ge \phi^j$} \\
    for $k=1,\dots,\id{newtonits}$ \\+
        $\rho_p(c) := N^j(g^j+y^j+c\psi_p^j)[\psi_p^j] - \ell^j[\psi_p^j]$ \\
        $r_p, \delta_p = \rho_p(0), \rho_p'(0)$ \qquad\qquad\qquad\qquad \ct{compute and save for all $p$}\\
        for $p=1,\dots,m_j$ \\+
            $c = \pr{pointupdate}(r_p, \delta_p,y_p,\phi_p,\ell^j[\psi_p^j])$ \\
            $y_p \gets y_p + \id{omega}\,c$
\end{pseudo*}
\caption{Projected nonlinear Jacobi as a smoother.}
\label{pc:pnj}
\end{pcode}


\section{Multilevel constraint decomposition} \label{sec:mcdstokes}

FIXME CP residual norm

FIXME MCD theory

FIXME nonlinear MCD V-cycle Pseudocode \ref{pc:mcdn-vcycle}

\begin{pcode}[ht]
\begin{pseudo*}
\pr{mcdn-vcycle}(J,w^J,N,\ell^J,\chi^J,\id{down}=1,\id{coarse}=1,\id{up}=0)\text{:} \\+
    $g^J = w^J$ \\
    for $j=J$ downto $j=1$ \\+
      $\chi^{j-1} = \mR \chi^j$ \\
      $\phi^j = \chi^j - P\chi^{j-1}$ \\
      $y^j = 0$ \\
      $\text{\pr{smoother}}^{\text{\id{down}}}(j,g^j,y^j,N^j,\ell^j,\phi^j)$ \qquad \ct{smoothing in $\mathcal{K}^j$} \\
      $F = N^j(g^j+y^j) - \ell^j$ \\
      $g^{j-1} = \iR(g^j + y^j)$ \\
      $\ell^{j-1} = N^{j-1}(g^{j-1}) - R F$ \\-
    $y^0 = 0$ \\
    $\text{\pr{smoother}}^{\text{\id{coarse}}}(0,g^0,y^0,N^0,\ell^0,\chi^0)$ \\
    $z^0 = y^0$ \\
    for $j=1$ to $j=J$ \\+
      $z^j = P z^{j-1} + y^{j}$ \\
      $\text{\pr{smoother}}^{\text{\id{up}}}(j,g^j,z^j,N^j,\ell^j,\chi^j)$ \qquad \ct{smoothing in $\mathcal{D}^j$} \\-
    return $z^J$
\end{pseudo*}
\caption{Nonlinear MCD V-cycle.}
\label{pc:mcdn-vcycle}
\end{pcode}

FIXME we will iterate \pr{mcdn-vcycle} until the CP residual norm has been reduced by a tolerance factor, as in Pseudocode \ref{pc:mcdn-solver}

\begin{pcode}[ht]
\begin{pseudo*}
\pr{mcdn-solver}(J,w^J,N,a,b,\id{rtol}=10^{-3},\id{cyclemax}=100)\text{:} \\+
    $\ell^J = \ip{a}{\cdot}$ \\
    $F(z)[\cdot] := N^J(z)[\cdot] - \ell^J[\cdot]$ \\
    $r_0=\|\hat\bF(w^J)\|$ \\
    for $s=1,\dots,\id{cyclemax}$ \\+
        $\chi^J = b^J - w^J$ \\
        $w^J\gets w^J+\pr{mcdn-vcycle}(J,w^J,N,\ell^J,\chi^J)$ \\
        if $\|\hat\bF(w^J)\| \le \id{rtol} \, r_0$ \\+
            break \\--
\end{pseudo*}
\caption{The SIGP is solved by iterating \pr{mcdn-vcycle}.}
\label{pc:mcdn-solver}
\end{pcode}

FIXME PETSc \cite{Balayetal2020,Bueler2021} used to solve the dynamics problem and thereby evaluate the residual $F$

FIXME in this paper the Glen-Stokes problem is solved by Newton linearization and (parallel) direct solution of the Newton step equations; however, geometric multigrid is available already for Glen-Stokes dynamics \cite{IsaacStadlerGhattas2015}; see also \cite{BrownSmithAhmadia2013} and \cite{Tuminaroetal2016} which solve a first-order approximation of the Glen-Stokes ice sheet problem by geometric and algebraic multigrid, respectively

FIXME convergence results; scaling results

\section{Multilevel methods for evolving geometry} \label{sec:evolution}

FIXME time-dependent runs


\section*{Acknowledgments}  Thanks to David Maxwell for suggestions on the formulation and well-posedness of the model.

\small

\bigskip
\bibliography{msg}
\bibliographystyle{siam}

\appendix

\section{Glossary of acronyms} \label{app:glossary}

\renewcommand{\arraystretch}{1.1}
\begin{longtable}{l|ll}
\toprule
\textbf{Acronym} {\Large$\strut$} & \textbf{Definition} & \textbf{Reference} \\ \hline
CMB & climatic mass balance & Section \ref{sec:stokesgeometry} \\
FE & finite element & Section \ref{sec:fe} \\
IDO & ice dynamics operator & Section \ref{sec:weakido}, eqn.~\eqref{eq:ido} \\
IIGP & implicit ice geometry problem & Section \ref{sec:evolution} \\
MCD & multilevel constraint decomposition & Section \ref{sec:mcdstokes} \\
NCP & nonlinear complementarity problem & Section \ref{sec:stokesgeometry} \\
PNJ & projected, nonlinear Jacobi & Section \ref{sec:smoothers} \\
SIA & shallow ice approximation & Section \ref{sec:intro} \\
SIGP & steady ice geometry problem & Section \ref{sec:stokesgeometry}, eqn.~\eqref{eq:strongform} \\
SKE & surface kinematical equation & Section \ref{sec:stokesgeometry}, eqn.~\eqref{eq:ske} \\
VI & variational inequality & Section \ref{sec:weakido} \\
WU & work units & Section \ref{sec:mcdstokes} \\ % final \\ required
\bottomrule
\caption{Glossary of acronyms used in this paper.}
\label{tab:acronyms}
\end{longtable}

\end{document}
